# Development Dockerfile
FROM node:18-alpine

# Install rclone
RUN apk add --no-cache wget unzip
RUN wget https://downloads.rclone.org/v1.71.0/rclone-v1.71.0-linux-amd64.zip && \
    unzip rclone-v1.71.0-linux-amd64.zip && \
    mv rclone-v1.71.0-linux-amd64/rclone /usr/local/bin/ && \
    chmod +x /usr/local/bin/rclone && \
    rm -rf rclone-v1.71.0-linux-amd64*

# Create app directory
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install all dependencies (including dev dependencies)
RUN npm install

# Install client dependencies
COPY client/package*.json ./client/
WORKDIR /app/client
RUN npm install

# Back to app directory
WORKDIR /app

# Create necessary directories
RUN mkdir -p data logs server/data server/logs config

# Expose ports
EXPOSE 3000 5173

# Development command
CMD ["npm", "run", "dev"]
